<html>

<head>
    <meta charset="UTF-8">

    <link href="style.css" rel="stylesheet"></link>

    <!-- The Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.3.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.3.0/firebase-database.js"></script>

    <!-- Jquery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <script src="init-database.js"></script>
</head>

<body>

    <div> <!-- Table that shows how many products, orders, and suppliers there are in realtime. -->
        <table>
            <td>Products: <span class="NumProducts">0</span></td>
            <td>|</td>
            <td>Orders: <span class="NumOrders">0</span></td>
            <td>|</td>
            <td>Suppliers: <span class="NumSuppliers">0</span></td>
        </table>
        <script>
            var num_products = 0;
            var num_Orders = 0;
            var num_Suppliers = 0;
            var updateNumProducts = amnt => $(".NumProducts").html(num_products = num_products + amnt);
            var updateNumOrders = amnt => $(".NumOrders").html(num_Orders = num_Orders + amnt);
            var updateNumSuppliers = amnt => $(".NumSuppliers").html(num_Suppliers = num_Suppliers + amnt);
            database.ref("Product").on("child_added", child => updateNumProducts(1));
            database.ref("Product").on("child_removed", child => updateNumProducts(-1));
            database.ref("Order").on("child_added", child => updateNumOrders(1));
            database.ref("Order").on("child_removed", child => updateNumOrders(-1));
            database.ref("Supplier").on("child_added", child => updateNumSuppliers(1));
            database.ref("Supplier").on("child_removed", child => updateNumSuppliers(-1));
        </script>
    </div>

    <form class="AddForm">
        <p>Add new order</p>
        <label>Select product: 
            <select id="addOrderProductId"></select>
            <script>
                database.ref("Product").on("child_added", data => {
                    if(data.key === "NextId") return;
                    $("#addOrderProductId").append(`<option value="${data.val().ProductId}"> ${data.val().ProductCode} </option>`);
                });
                database.ref("Product").on("child_removed", data => {
                    if(data.key === "NextId") return;
                    $(`#addOrderProductId > option[value=${data.val().ProductId}]`).remove();
                });
            </script>
        </label>
        <label>Enter quantity: 
            <input type="number" id="quantity">
        </label>
        <button id="addOrderBtn">Add</button>
    </form>

    <form class="AddForm">
        <p>Add new product</p>
        <label>Enter product code: 
            <input type="text" id="addProdCode">
        </label>
        <label>Enter quantity: 
            <input type="number" id="addProdQuantity">
        </label>
        <label>Enter price: 
            <input type="number" id="addProdPrice">
        </label>
        <button id="addProductBtn">Add product</button>
    </form>
    <br>
    <form class="AddForm">
        <p>Add new suplier</p>
        <label>Enter name: 
            <input type="text" id="supplierName">
        </label>
        <label>Enter phone number: 
            <input type="number" id="supplierNumber">
        </label>
        <button id="addSupplierBtn">Add supplier</button>
    </form>
    
    <form class="AddForm">
        <p>Add new product-supplier </p>
        <label>Select product: 
            <select id="productSupplierProductId"></select>
            <script>
                database.ref("Product").on("child_added", data => {
                    if(data.key === "NextId") return;
                    $("#productSupplierProductId").append(`<option value="${data.val().ProductId}"> ${data.val().ProductCode} </option>`);
                });
                database.ref("Product").on("child_removed", data => {
                    if(data.key === "NextId") return;
                    $(`#productSupplierProductId > option[value=${data.val().ProductId}]`).remove();
                });
                database.ref("ProductSupplier").on("child_added", data => {
                    if(data.key === "NextId") return;
                    $(`#productSupplierProductId > option[value=${data.val().ProductId}]`).remove();
                });
            </script>
        </label>
        <label>Select supplier: 
            <select id="productSupplierSupplierId"></select>
            <script>
                database.ref("Supplier").on("child_added", data => {
                    if(data.key === "NextId") return;
                    $("#productSupplierSupplierId").append(`<option value="${data.val().SupplierId}"> ${data.val().Name} </option>`);
                });
                database.ref("Supplier").on("child_removed", data => {
                    if(data.key === "NextId") return;
                    $(`#productSupplierSupplierId > option[value=${data.val().SupplierId}]`).remove();
                });
            </script>
        </label>
        <button id="addProductSupplierBtn">Add Product Supplier</button>
    </form>

    <!-- Our main script is placed at the bottom of the document so that everything is loaded when it runs -->
    <script src="tempName.js"></script>
    <script src="function.js"></script>
</body>

</html>